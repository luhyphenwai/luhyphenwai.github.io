<!DOCTYPE html>
<html>
    <head>
        <title>COVID-19 Tracker</title>
        <link rel="stylesheet" href="style.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet">
    </head>

    <body lang="en" background="/Images/pariag2.PNG">
        <!-- Top menu bar -->
        <nav class="topbar">
            <div class="titlebox">
                <p class = "topbarText"> &lt;/luwai&gt; </p>    
            </div>
            <ul>
                <li><a class = "topbarText"href="../projects.html">My Stuff</a></li>
                <li><a class = "topbarText"href="../index.html">Home</a></li>
            </ul>
        </nav>
        
        <div style="height: 100px;"></div>
        <div class="wrapper">
            <!-- Main Body of Site -->
        <div style="height: 25px;"></div>
        <h1 style="font-size: 40px;">COVID-19 STATISTICS</h1>
        
        <h1>Global Statistics</h1>
        <div class="flexbox-container">
            <h2 id="gCases" class="flexbox-item">Total Cases:</h2>
            <h2 id="gDeaths" class="flexbox-item">Total Deaths:</h2>
            <h2 id="gRecovered" class="flexbox-item">Total Recovered:</h2>
        </div>

        <h1>Country Statistics</h1>
        <div class="flexbox-container">
            <h2 id="cases" class="flexbox-item">Total Cases: None</h2>
            <h2 id="deaths" class="flexbox-item">Total Deaths: None</h2>
            <h2 id="recovered" class="flexbox-item">Total Recovered: None</h2>
        </div>
        <p>Select a Country</p>
        <select id="country" name="country">
            
        </select>
        <button onclick="fetchData()">Refresh Stats</button>
        
        
        <script>

            // Dropdown menu
            let country = document.getElementById("country").value
            let dropdown = document.getElementById("country")

            generateDropDownList();
            setGlobalData();
            
            
            

            function generateDropDownList(){
                fetch("https://api.covid19api.com/summary")
                .then(res => {
                    if(res.ok){
                        console.log("SUCCESS")
                    }   else {
                        console.log("Not Successful")
                    }
                    return res.json()
                })
                .then(data => {
                    data.Countries.forEach((obj, index) => {
                    var dropdownObj = document.createElement("option")
                    dropdownObj.textContent = obj.Country;
                    dropdownObj.value = obj.Country;
                    dropdown.appendChild(dropdownObj)
                });
                })
                .catch(error => console.log("ERROR"))

                setGlobalData();
            
            }

            function fetchData(){
                country = document.getElementById("country").value
                console.log(country)
                fetch("https://api.covid19api.com/summary")
                .then(res => {
                    if(res.ok){
                        console.log("SUCCESS")
                    }   else {
                        console.log("Not Successful")
                    }
                    return res.json()
                })
                .then(data => generateHTML(data))
                .catch(error => console.log("ERROR"))

                setGlobalData();
            
            }
            
            function generateHTML(data){
                console.log(data)
                data.Countries.forEach((obj, index) => {
                    if (obj.Country == country){
                                
                        document.getElementById("cases").textContent = "Total Cases: " +Number(obj.TotalConfirmed).toLocaleString()
                        document.getElementById("deaths").textContent = "Total Deaths: " +Number(obj.TotalDeaths).toLocaleString()
                        document.getElementById("recovered").textContent = "Total Recovered: " +Number(obj.TotalRecovered).toLocaleString()
                    }
                });
            }

            function setGlobalData(){
                fetch("https://api.covid19api.com/summary")
                .then(res => {
                    if(res.ok){
                        console.log("SUCCESS")
                    }   else {
                        console.log("Not Successful")
                    }
                    return res.json()
                })
                .then(data => {
                    document.getElementById("gCases").textContent = "Total Cases: " +Number(data.Global.TotalConfirmed).toLocaleString()
                    document.getElementById("gDeaths").textContent = "Total Deaths: " +Number(data.Global.TotalDeaths).toLocaleString()
                    document.getElementById("gRecovered").textContent = "Total Recovered: " +Number(data.Global.TotalRecovered).toLocaleString()
                })
                .catch(error => console.log("ERROR"))
            }
        </script>
        <div style="height: 50px;"></div>
        </div>
        
    </body>
</html>